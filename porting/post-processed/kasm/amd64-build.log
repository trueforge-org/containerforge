#0 building with "default" instance using docker driver

#1 [internal] load build definition from Dockerfile
#1 DONE 0.0s

#1 [internal] load build definition from Dockerfile
#1 transferring dockerfile: 4.01kB done
#1 DONE 0.0s

#2 [internal] load metadata for ghcr.io/trueforge-org/ubuntu:24.04
#2 DONE 0.1s

#3 [internal] load .dockerignore
#3 transferring context: 2B done
#3 DONE 0.0s

#4 [1/5] FROM ghcr.io/trueforge-org/ubuntu:24.04@sha256:5348eb7725294e8090c15b7b495e517f82f4b31497d3bb9de71bbe37476e7454
#4 resolve ghcr.io/trueforge-org/ubuntu:24.04@sha256:5348eb7725294e8090c15b7b495e517f82f4b31497d3bb9de71bbe37476e7454 0.0s done
#4 CACHED

#5 [internal] load build context
#5 transferring context: 19.62kB done
#5 DONE 0.0s

#6 [2/5] RUN   echo "**** install packages ****" &&   curl -fsSL https://download.docker.com/linux/ubuntu/gpg | apt-key add - &&   echo "deb [arch=amd64] https://download.docker.com/linux/ubuntu noble stable" >     /etc/apt/sources.list.d/docker.list &&   curl -fsSL https://nvidia.github.io/libnvidia-container/gpgkey | gpg --dearmor -o /usr/share/keyrings/nvidia-container-toolkit-keyring.gpg     && curl -s -L https://nvidia.github.io/libnvidia-container/stable/deb/nvidia-container-toolkit.list |       sed 's#deb https://#deb [signed-by=/usr/share/keyrings/nvidia-container-toolkit-keyring.gpg] https://#g' |       tee /etc/apt/sources.list.d/nvidia-container-toolkit.list &&   curl -fsSL https://deb.nodesource.com/setup_20.x | bash - &&   echo "Package: docker-ce docker-ce-cli docker-ce-rootless-extras   Pin: version 5:28.*   Pin-Priority: 1001" > /etc/apt/preferences.d/docker &&   apt-get install -y --no-install-recommends     btrfs-progs     build-essential     containerd.io     docker-ce     docker-ce-cli     docker-compose-plugin     e2fsprogs     fuse-overlayfs     iproute2     iptables     lsof     nodejs     nvidia-container-toolkit     openssl     pigz     python3     sudo     uidmap     xfsprogs &&   echo "**** dind setup ****" &&   useradd -U dockremap &&   usermod -G dockremap dockremap &&   echo 'dockremap:165536:65536' >> /etc/subuid &&   echo 'dockremap:165536:65536' >> /etc/subgid &&   curl -o   /usr/local/bin/dind -L     https://raw.githubusercontent.com/moby/moby/master/hack/dind &&   chmod +x /usr/local/bin/dind &&   echo 'hosts: files dns' > /etc/nsswitch.conf &&   echo "**** setup wizard ****" &&   mkdir -p /wizard &&   echo "${VERSION}" > /version.txt &&   curl -o     /tmp/wizard.tar.gz -L     "https://github.com/kasmtech/kasm-install-wizard/archive/refs/tags/${VERSION}.tar.gz" &&   tar xf     /tmp/wizard.tar.gz -C     /wizard --strip-components=1 &&   cd /wizard &&   npm install &&   echo "**** add installer ****" &&   curl -o     /tmp/kasm.tar.gz -L     "https://github.com/kasmtech/kasm-install-wizard/releases/download/${VERSION}/kasm_release.tar.gz" &&   tar xf     /tmp/kasm.tar.gz -C     / &&   ALVERSION=$(cat /kasm_release/conf/database/seed_data/default_properties.yaml |awk '/alembic_version/ {print $2}') &&   curl -o     /tmp/images.tar.gz -L     "https://kasm-ci.s3.amazonaws.com/${VERSION}-images-combined.tar.gz" &&   tar xf     /tmp/images.tar.gz -C     / &&   sed -i     '/alembic_version/s/.*/alembic_version: '${ALVERSION}'/'     /kasm_release/conf/database/seed_data/default_images_a* &&   sed -i 's/-N -e -H/-N -B -e -H/g' /kasm_release/upgrade.sh &&   echo "exit 0" > /kasm_release/install_dependencies.sh &&   /kasm_release/bin/utils/yq_$(uname -m) -i     '.services.proxy.volumes += "/kasm_release/www/img/thumbnails:/srv/www/img/thumbnails"'     /kasm_release/docker/docker-compose-all.yaml &&   echo "**** copy assets ****" &&   cp     /kasm_release/www/img/thumbnails/*.png /kasm_release/www/img/thumbnails/*.svg     /wizard/public/img/thumbnails/ &&   cp     /kasm_release/conf/database/seed_data/default_images_a*     /wizard/ &&   useradd -u 70 kasm_db &&   useradd kasm &&   echo "**** cleanup ****" &&   apt-get remove -y g++ gcc make &&   apt-get -y autoremove &&   apt-get clean &&   rm -rf     /tmp/*     /var/lib/apt/lists/*     /var/tmp/*
#6 0.144 **** install packages ****
#6 0.197 Warning: apt-key is deprecated. Manage keyring files in trusted.gpg.d instead (see apt-key(8)).
#6 0.499 OK
#6 0.515 curl: (6) Could not resolve host: nvidia.github.io
#6 0.516 gpg: no valid OpenPGP data found.
#6 ERROR: process "/bin/bash -o pipefail -c echo \"**** install packages ****\" &&   curl -fsSL https://download.docker.com/linux/ubuntu/gpg | apt-key add - &&   echo \"deb [arch=$TARGETARCH] https://download.docker.com/linux/ubuntu noble stable\" >     /etc/apt/sources.list.d/docker.list &&   curl -fsSL https://nvidia.github.io/libnvidia-container/gpgkey | gpg --dearmor -o /usr/share/keyrings/nvidia-container-toolkit-keyring.gpg     && curl -s -L https://nvidia.github.io/libnvidia-container/stable/deb/nvidia-container-toolkit.list |       sed 's#deb https://#deb [signed-by=/usr/share/keyrings/nvidia-container-toolkit-keyring.gpg] https://#g' |       tee /etc/apt/sources.list.d/nvidia-container-toolkit.list &&   curl -fsSL https://deb.nodesource.com/setup_20.x | bash - &&   echo \"Package: docker-ce docker-ce-cli docker-ce-rootless-extras   Pin: version 5:28.*   Pin-Priority: 1001\" > /etc/apt/preferences.d/docker &&   apt-get install -y --no-install-recommends     btrfs-progs     build-essential     containerd.io     docker-ce     docker-ce-cli     docker-compose-plugin     e2fsprogs     fuse-overlayfs     iproute2     iptables     lsof     nodejs     nvidia-container-toolkit     openssl     pigz     python3     sudo     uidmap     xfsprogs &&   echo \"**** dind setup ****\" &&   useradd -U dockremap &&   usermod -G dockremap dockremap &&   echo 'dockremap:165536:65536' >> /etc/subuid &&   echo 'dockremap:165536:65536' >> /etc/subgid &&   curl -o   /usr/local/bin/dind -L     https://raw.githubusercontent.com/moby/moby/master/hack/dind &&   chmod +x /usr/local/bin/dind &&   echo 'hosts: files dns' > /etc/nsswitch.conf &&   echo \"**** setup wizard ****\" &&   mkdir -p /wizard &&   echo \"${VERSION}\" > /version.txt &&   curl -o     /tmp/wizard.tar.gz -L     \"https://github.com/kasmtech/kasm-install-wizard/archive/refs/tags/${VERSION}.tar.gz\" &&   tar xf     /tmp/wizard.tar.gz -C     /wizard --strip-components=1 &&   cd /wizard &&   npm install &&   echo \"**** add installer ****\" &&   curl -o     /tmp/kasm.tar.gz -L     \"https://github.com/kasmtech/kasm-install-wizard/releases/download/${VERSION}/kasm_release.tar.gz\" &&   tar xf     /tmp/kasm.tar.gz -C     / &&   ALVERSION=$(cat /kasm_release/conf/database/seed_data/default_properties.yaml |awk '/alembic_version/ {print $2}') &&   curl -o     /tmp/images.tar.gz -L     \"https://kasm-ci.s3.amazonaws.com/${VERSION}-images-combined.tar.gz\" &&   tar xf     /tmp/images.tar.gz -C     / &&   sed -i     '/alembic_version/s/.*/alembic_version: '${ALVERSION}'/'     /kasm_release/conf/database/seed_data/default_images_a* &&   sed -i 's/-N -e -H/-N -B -e -H/g' /kasm_release/upgrade.sh &&   echo \"exit 0\" > /kasm_release/install_dependencies.sh &&   /kasm_release/bin/utils/yq_$(uname -m) -i     '.services.proxy.volumes += \"/kasm_release/www/img/thumbnails:/srv/www/img/thumbnails\"'     /kasm_release/docker/docker-compose-all.yaml &&   echo \"**** copy assets ****\" &&   cp     /kasm_release/www/img/thumbnails/*.png /kasm_release/www/img/thumbnails/*.svg     /wizard/public/img/thumbnails/ &&   cp     /kasm_release/conf/database/seed_data/default_images_a*     /wizard/ &&   useradd -u 70 kasm_db &&   useradd kasm &&   echo \"**** cleanup ****\" &&   apt-get remove -y g++ gcc make &&   apt-get -y autoremove &&   apt-get clean &&   rm -rf     /tmp/*     /var/lib/apt/lists/*     /var/tmp/*" did not complete successfully: exit code: 2
------
 > [2/5] RUN   echo "**** install packages ****" &&   curl -fsSL https://download.docker.com/linux/ubuntu/gpg | apt-key add - &&   echo "deb [arch=amd64] https://download.docker.com/linux/ubuntu noble stable" >     /etc/apt/sources.list.d/docker.list &&   curl -fsSL https://nvidia.github.io/libnvidia-container/gpgkey | gpg --dearmor -o /usr/share/keyrings/nvidia-container-toolkit-keyring.gpg     && curl -s -L https://nvidia.github.io/libnvidia-container/stable/deb/nvidia-container-toolkit.list |       sed 's#deb https://#deb [signed-by=/usr/share/keyrings/nvidia-container-toolkit-keyring.gpg] https://#g' |       tee /etc/apt/sources.list.d/nvidia-container-toolkit.list &&   curl -fsSL https://deb.nodesource.com/setup_20.x | bash - &&   echo "Package: docker-ce docker-ce-cli docker-ce-rootless-extras   Pin: version 5:28.*   Pin-Priority: 1001" > /etc/apt/preferences.d/docker &&   apt-get install -y --no-install-recommends     btrfs-progs     build-essential     containerd.io     docker-ce     docker-ce-cli     docker-compose-plugin     e2fsprogs     fuse-overlayfs     iproute2     iptables     lsof     nodejs     nvidia-container-toolkit     openssl     pigz     python3     sudo     uidmap     xfsprogs &&   echo "**** dind setup ****" &&   useradd -U dockremap &&   usermod -G dockremap dockremap &&   echo 'dockremap:165536:65536' >> /etc/subuid &&   echo 'dockremap:165536:65536' >> /etc/subgid &&   curl -o   /usr/local/bin/dind -L     https://raw.githubusercontent.com/moby/moby/master/hack/dind &&   chmod +x /usr/local/bin/dind &&   echo 'hosts: files dns' > /etc/nsswitch.conf &&   echo "**** setup wizard ****" &&   mkdir -p /wizard &&   echo "${VERSION}" > /version.txt &&   curl -o     /tmp/wizard.tar.gz -L     "https://github.com/kasmtech/kasm-install-wizard/archive/refs/tags/${VERSION}.tar.gz" &&   tar xf     /tmp/wizard.tar.gz -C     /wizard --strip-components=1 &&   cd /wizard &&   npm install &&   echo "**** add installer ****" &&   curl -o     /tmp/kasm.tar.gz -L     "https://github.com/kasmtech/kasm-install-wizard/releases/download/${VERSION}/kasm_release.tar.gz" &&   tar xf     /tmp/kasm.tar.gz -C     / &&   ALVERSION=$(cat /kasm_release/conf/database/seed_data/default_properties.yaml |awk '/alembic_version/ {print $2}') &&   curl -o     /tmp/images.tar.gz -L     "https://kasm-ci.s3.amazonaws.com/${VERSION}-images-combined.tar.gz" &&   tar xf     /tmp/images.tar.gz -C     / &&   sed -i     '/alembic_version/s/.*/alembic_version: '${ALVERSION}'/'     /kasm_release/conf/database/seed_data/default_images_a* &&   sed -i 's/-N -e -H/-N -B -e -H/g' /kasm_release/upgrade.sh &&   echo "exit 0" > /kasm_release/install_dependencies.sh &&   /kasm_release/bin/utils/yq_$(uname -m) -i     '.services.proxy.volumes += "/kasm_release/www/img/thumbnails:/srv/www/img/thumbnails"'     /kasm_release/docker/docker-compose-all.yaml &&   echo "**** copy assets ****" &&   cp     /kasm_release/www/img/thumbnails/*.png /kasm_release/www/img/thumbnails/*.svg     /wizard/public/img/thumbnails/ &&   cp     /kasm_release/conf/database/seed_data/default_images_a*     /wizard/ &&   useradd -u 70 kasm_db &&   useradd kasm &&   echo "**** cleanup ****" &&   apt-get remove -y g++ gcc make &&   apt-get -y autoremove &&   apt-get clean &&   rm -rf     /tmp/*     /var/lib/apt/lists/*     /var/tmp/*:
0.144 **** install packages ****
0.197 Warning: apt-key is deprecated. Manage keyring files in trusted.gpg.d instead (see apt-key(8)).
0.499 OK
0.515 curl: (6) Could not resolve host: nvidia.github.io
0.516 gpg: no valid OpenPGP data found.
------
Dockerfile:17
--------------------
  16 |     # Container setup
  17 | >>> RUN \
  18 | >>>   echo "**** install packages ****" && \
  19 | >>>   curl -fsSL https://download.docker.com/linux/ubuntu/gpg | apt-key add - && \
  20 | >>>   echo "deb [arch=$TARGETARCH] https://download.docker.com/linux/ubuntu noble stable" > \
  21 | >>>     /etc/apt/sources.list.d/docker.list && \
  22 | >>>   curl -fsSL https://nvidia.github.io/libnvidia-container/gpgkey | gpg --dearmor -o /usr/share/keyrings/nvidia-container-toolkit-keyring.gpg \
  23 | >>>     && curl -s -L https://nvidia.github.io/libnvidia-container/stable/deb/nvidia-container-toolkit.list | \
  24 | >>>       sed 's#deb https://#deb [signed-by=/usr/share/keyrings/nvidia-container-toolkit-keyring.gpg] https://#g' | \
  25 | >>>       tee /etc/apt/sources.list.d/nvidia-container-toolkit.list && \
  26 | >>>   curl -fsSL https://deb.nodesource.com/setup_20.x | bash - && \
  27 | >>>   echo "Package: docker-ce docker-ce-cli docker-ce-rootless-extras \
  28 | >>>   Pin: version 5:28.* \
  29 | >>>   Pin-Priority: 1001" > /etc/apt/preferences.d/docker && \
  30 | >>>   apt-get install -y --no-install-recommends \
  31 | >>>     btrfs-progs \
  32 | >>>     build-essential \
  33 | >>>     containerd.io \
  34 | >>>     docker-ce \
  35 | >>>     docker-ce-cli \
  36 | >>>     docker-compose-plugin \
  37 | >>>     e2fsprogs \
  38 | >>>     fuse-overlayfs \
  39 | >>>     iproute2 \
  40 | >>>     iptables \
  41 | >>>     lsof \
  42 | >>>     nodejs \
  43 | >>>     nvidia-container-toolkit \
  44 | >>>     openssl \
  45 | >>>     pigz \
  46 | >>>     python3 \
  47 | >>>     sudo \
  48 | >>>     uidmap \
  49 | >>>     xfsprogs && \
  50 | >>>   echo "**** dind setup ****" && \
  51 | >>>   useradd -U dockremap && \
  52 | >>>   usermod -G dockremap dockremap && \
  53 | >>>   echo 'dockremap:165536:65536' >> /etc/subuid && \
  54 | >>>   echo 'dockremap:165536:65536' >> /etc/subgid && \
  55 | >>>   curl -o \
  56 | >>>   /usr/local/bin/dind -L \
  57 | >>>     https://raw.githubusercontent.com/moby/moby/master/hack/dind && \
  58 | >>>   chmod +x /usr/local/bin/dind && \
  59 | >>>   echo 'hosts: files dns' > /etc/nsswitch.conf && \
  60 | >>>   echo "**** setup wizard ****" && \
  61 | >>>   mkdir -p /wizard && \
  62 | >>>   echo "${VERSION}" > /version.txt && \
  63 | >>>   curl -o \
  64 | >>>     /tmp/wizard.tar.gz -L \
  65 | >>>     "https://github.com/kasmtech/kasm-install-wizard/archive/refs/tags/${VERSION}.tar.gz" && \
  66 | >>>   tar xf \
  67 | >>>     /tmp/wizard.tar.gz -C \
  68 | >>>     /wizard --strip-components=1 && \
  69 | >>>   cd /wizard && \
  70 | >>>   npm install && \
  71 | >>>   echo "**** add installer ****" && \
  72 | >>>   curl -o \
  73 | >>>     /tmp/kasm.tar.gz -L \
  74 | >>>     "https://github.com/kasmtech/kasm-install-wizard/releases/download/${VERSION}/kasm_release.tar.gz" && \
  75 | >>>   tar xf \
  76 | >>>     /tmp/kasm.tar.gz -C \
  77 | >>>     / && \
  78 | >>>   ALVERSION=$(cat /kasm_release/conf/database/seed_data/default_properties.yaml |awk '/alembic_version/ {print $2}') && \
  79 | >>>   curl -o \
  80 | >>>     /tmp/images.tar.gz -L \
  81 | >>>     "https://kasm-ci.s3.amazonaws.com/${VERSION}-images-combined.tar.gz" && \
  82 | >>>   tar xf \
  83 | >>>     /tmp/images.tar.gz -C \
  84 | >>>     / && \
  85 | >>>   sed -i \
  86 | >>>     '/alembic_version/s/.*/alembic_version: '${ALVERSION}'/' \
  87 | >>>     /kasm_release/conf/database/seed_data/default_images_a* && \
  88 | >>>   sed -i 's/-N -e -H/-N -B -e -H/g' /kasm_release/upgrade.sh && \
  89 | >>>   echo "exit 0" > /kasm_release/install_dependencies.sh && \
  90 | >>>   /kasm_release/bin/utils/yq_$(uname -m) -i \
  91 | >>>     '.services.proxy.volumes += "/kasm_release/www/img/thumbnails:/srv/www/img/thumbnails"' \
  92 | >>>     /kasm_release/docker/docker-compose-all.yaml && \
  93 | >>>   echo "**** copy assets ****" && \
  94 | >>>   cp \
  95 | >>>     /kasm_release/www/img/thumbnails/*.png /kasm_release/www/img/thumbnails/*.svg \
  96 | >>>     /wizard/public/img/thumbnails/ && \
  97 | >>>   cp \
  98 | >>>     /kasm_release/conf/database/seed_data/default_images_a* \
  99 | >>>     /wizard/ && \
 100 | >>>   useradd -u 70 kasm_db && \
 101 | >>>   useradd kasm && \
 102 | >>>   echo "**** cleanup ****" && \
 103 | >>>   apt-get remove -y g++ gcc make && \
 104 | >>>   apt-get -y autoremove && \
 105 | >>>   apt-get clean && \
 106 | >>>   rm -rf \
 107 | >>>     /tmp/* \
 108 | >>>     /var/lib/apt/lists/* \
 109 | >>>     /var/tmp/*
 110 |     
--------------------
ERROR: failed to build: failed to solve: process "/bin/bash -o pipefail -c echo \"**** install packages ****\" &&   curl -fsSL https://download.docker.com/linux/ubuntu/gpg | apt-key add - &&   echo \"deb [arch=$TARGETARCH] https://download.docker.com/linux/ubuntu noble stable\" >     /etc/apt/sources.list.d/docker.list &&   curl -fsSL https://nvidia.github.io/libnvidia-container/gpgkey | gpg --dearmor -o /usr/share/keyrings/nvidia-container-toolkit-keyring.gpg     && curl -s -L https://nvidia.github.io/libnvidia-container/stable/deb/nvidia-container-toolkit.list |       sed 's#deb https://#deb [signed-by=/usr/share/keyrings/nvidia-container-toolkit-keyring.gpg] https://#g' |       tee /etc/apt/sources.list.d/nvidia-container-toolkit.list &&   curl -fsSL https://deb.nodesource.com/setup_20.x | bash - &&   echo \"Package: docker-ce docker-ce-cli docker-ce-rootless-extras   Pin: version 5:28.*   Pin-Priority: 1001\" > /etc/apt/preferences.d/docker &&   apt-get install -y --no-install-recommends     btrfs-progs     build-essential     containerd.io     docker-ce     docker-ce-cli     docker-compose-plugin     e2fsprogs     fuse-overlayfs     iproute2     iptables     lsof     nodejs     nvidia-container-toolkit     openssl     pigz     python3     sudo     uidmap     xfsprogs &&   echo \"**** dind setup ****\" &&   useradd -U dockremap &&   usermod -G dockremap dockremap &&   echo 'dockremap:165536:65536' >> /etc/subuid &&   echo 'dockremap:165536:65536' >> /etc/subgid &&   curl -o   /usr/local/bin/dind -L     https://raw.githubusercontent.com/moby/moby/master/hack/dind &&   chmod +x /usr/local/bin/dind &&   echo 'hosts: files dns' > /etc/nsswitch.conf &&   echo \"**** setup wizard ****\" &&   mkdir -p /wizard &&   echo \"${VERSION}\" > /version.txt &&   curl -o     /tmp/wizard.tar.gz -L     \"https://github.com/kasmtech/kasm-install-wizard/archive/refs/tags/${VERSION}.tar.gz\" &&   tar xf     /tmp/wizard.tar.gz -C     /wizard --strip-components=1 &&   cd /wizard &&   npm install &&   echo \"**** add installer ****\" &&   curl -o     /tmp/kasm.tar.gz -L     \"https://github.com/kasmtech/kasm-install-wizard/releases/download/${VERSION}/kasm_release.tar.gz\" &&   tar xf     /tmp/kasm.tar.gz -C     / &&   ALVERSION=$(cat /kasm_release/conf/database/seed_data/default_properties.yaml |awk '/alembic_version/ {print $2}') &&   curl -o     /tmp/images.tar.gz -L     \"https://kasm-ci.s3.amazonaws.com/${VERSION}-images-combined.tar.gz\" &&   tar xf     /tmp/images.tar.gz -C     / &&   sed -i     '/alembic_version/s/.*/alembic_version: '${ALVERSION}'/'     /kasm_release/conf/database/seed_data/default_images_a* &&   sed -i 's/-N -e -H/-N -B -e -H/g' /kasm_release/upgrade.sh &&   echo \"exit 0\" > /kasm_release/install_dependencies.sh &&   /kasm_release/bin/utils/yq_$(uname -m) -i     '.services.proxy.volumes += \"/kasm_release/www/img/thumbnails:/srv/www/img/thumbnails\"'     /kasm_release/docker/docker-compose-all.yaml &&   echo \"**** copy assets ****\" &&   cp     /kasm_release/www/img/thumbnails/*.png /kasm_release/www/img/thumbnails/*.svg     /wizard/public/img/thumbnails/ &&   cp     /kasm_release/conf/database/seed_data/default_images_a*     /wizard/ &&   useradd -u 70 kasm_db &&   useradd kasm &&   echo \"**** cleanup ****\" &&   apt-get remove -y g++ gcc make &&   apt-get -y autoremove &&   apt-get clean &&   rm -rf     /tmp/*     /var/lib/apt/lists/*     /var/tmp/*" did not complete successfully: exit code: 2
